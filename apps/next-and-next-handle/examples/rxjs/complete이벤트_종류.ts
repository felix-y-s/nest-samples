import { timer, Subject, switchMap, scan, tap, map, interval } from 'rxjs';

/**
 * complete ì´ë²¤íŠ¸ì˜ ì¢…ë¥˜ì™€ ë°œìƒ ì‹œì 
 * ë‚´ë¶€ Observableì˜ complete vs ì™¸ë¶€ Observableì˜ complete
 */

console.log('===== 1. timerì˜ ìë™ complete =====\n');

// ===== timerëŠ” ìë™ìœ¼ë¡œ completeë¥¼ ë°œìƒì‹œí‚´ =====

console.log('--- ì˜ˆì œ 1: timerëŠ” ìë™ ì™„ë£Œ ---\n');

timer(1000).pipe(
  tap({
    next: (value) => console.log(`ê°’: ${value}`),
    complete: () => console.log('âœ… timer ìë™ ì™„ë£Œ!')
  })
).subscribe({
  next: (value) => console.log(`êµ¬ë… ê°’: ${value}`),
  complete: () => console.log('âœ… êµ¬ë… ì™„ë£Œ!')
});

// ì¶œë ¥:
// (1ì´ˆ í›„)
// ê°’: 0
// êµ¬ë… ê°’: 0
// âœ… timer ìë™ ì™„ë£Œ!  â† timerê°€ ìë™ìœ¼ë¡œ complete ë°œìƒ!
// âœ… êµ¬ë… ì™„ë£Œ!


console.log('\n\n===== 2. ë‚´ë¶€ Observable vs ì™¸ë¶€ Observableì˜ complete =====\n');

// ===== ì˜ˆì œ 2: switchMap ë‚´ë¶€ Observableì˜ ìë™ ì™„ë£Œ =====

console.log('--- ì˜ˆì œ 2: ë‚´ë¶€ timerëŠ” ìë™ ì™„ë£Œë¨ ---\n');

const click$ = new Subject<void>();

const counter$ = click$.pipe(
  scan(count => count + 1, 0),
  tap(count => console.log(`\n[scan] ì¹´ìš´íŠ¸: ${count}`)),
  switchMap((count) => {
    console.log(`[switchMap] timer ì‹œì‘`);

    return timer(1000).pipe(
      map(() => count),
      tap({
        next: () => console.log(`[ë‚´ë¶€ tap] ê°’ í†µê³¼`),
        complete: () => console.log(`[ë‚´ë¶€ tap] âœ… timer ì™„ë£Œ (ì¹´ìš´íŠ¸ ${count})`)
      })
    );
  }),
  tap({
    next: (count) => console.log(`[ì™¸ë¶€ tap] ê°’ í†µê³¼: ${count}`),
    complete: () => console.log(`[ì™¸ë¶€ tap] âŒ ì „ì²´ ìŠ¤íŠ¸ë¦¼ ì™„ë£Œ`)
  })
);

counter$.subscribe({
  next: (count) => console.log(`[êµ¬ë…] âœ¨ ìµœì¢… ì¹´ìš´íŠ¸: ${count}`),
  complete: () => console.log(`[êµ¬ë…] âŒ êµ¬ë… ì™„ë£Œ`)
});

// í´ë¦­ ì‹œë®¬ë ˆì´ì…˜
setTimeout(() => {
  console.log('\n========== ğŸ‘† í´ë¦­ 1 ==========');
  click$.next();
}, 100);

setTimeout(() => {
  console.log('\n========== ğŸ‘† í´ë¦­ 2 ==========');
  click$.next();
}, 1500);

// Subject ì™„ë£ŒëŠ” ì£¼ì„ ì²˜ë¦¬ (í˜¸ì¶œ ì•ˆ í•¨)
// setTimeout(() => {
//   console.log('\n========== ğŸ›‘ Subject ì™„ë£Œ ==========');
//   click$.complete();
// }, 3000);


// ì¶œë ¥ ì˜ˆìƒ:
// ========== ğŸ‘† í´ë¦­ 1 ==========
// [scan] ì¹´ìš´íŠ¸: 1
// [switchMap] timer ì‹œì‘
//
// (1ì´ˆ í›„)
// [ë‚´ë¶€ tap] ê°’ í†µê³¼
// [ë‚´ë¶€ tap] âœ… timer ì™„ë£Œ (ì¹´ìš´íŠ¸ 1) â† timer ìë™ ì™„ë£Œ!
// [ì™¸ë¶€ tap] ê°’ í†µê³¼: 1
// [êµ¬ë…] âœ¨ ìµœì¢… ì¹´ìš´íŠ¸: 1
//
// ========== ğŸ‘† í´ë¦­ 2 ==========
// [scan] ì¹´ìš´íŠ¸: 2
// [switchMap] timer ì‹œì‘
//
// (1ì´ˆ í›„)
// [ë‚´ë¶€ tap] ê°’ í†µê³¼
// [ë‚´ë¶€ tap] âœ… timer ì™„ë£Œ (ì¹´ìš´íŠ¸ 2) â† timer ìë™ ì™„ë£Œ!
// [ì™¸ë¶€ tap] ê°’ í†µê³¼: 2
// [êµ¬ë…] âœ¨ ìµœì¢… ì¹´ìš´íŠ¸: 2
//
// [ì™¸ë¶€ tap] âŒ ì „ì²´ ìŠ¤íŠ¸ë¦¼ ì™„ë£Œ - í˜¸ì¶œ ì•ˆ ë¨! (click$ê°€ complete ì•ˆ í•¨)
// [êµ¬ë…] âŒ êµ¬ë… ì™„ë£Œ - í˜¸ì¶œ ì•ˆ ë¨!


console.log('\n\n===== 3. Observableë³„ complete ë™ì‘ =====\n');

console.log(`
Observable ì¢…ë¥˜ë³„ complete ë°œìƒ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ìë™ complete (Cold Observable):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

timer(1000)
  â†’ 1ì´ˆ í›„ ê°’ ë°©ì¶œ
  â†’ ìë™ìœ¼ë¡œ complete ë°œìƒ âœ…
  â†’ êµ¬ë… ìë™ ì¢…ë£Œ

of(1, 2, 3)
  â†’ ëª¨ë“  ê°’ ë°©ì¶œ (1, 2, 3)
  â†’ ìë™ìœ¼ë¡œ complete ë°œìƒ âœ…
  â†’ êµ¬ë… ìë™ ì¢…ë£Œ

from([1, 2, 3])
  â†’ ë°°ì—´ì˜ ëª¨ë“  ê°’ ë°©ì¶œ
  â†’ ìë™ìœ¼ë¡œ complete ë°œìƒ âœ…
  â†’ êµ¬ë… ìë™ ì¢…ë£Œ


ìˆ˜ë™ complete í•„ìš” (Hot Observable / ë¬´í•œ ìŠ¤íŠ¸ë¦¼):
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Subject
  â†’ ëª…ì‹œì ìœ¼ë¡œ .complete() í˜¸ì¶œ í•„ìš” âŒ
  â†’ í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ì˜ì›íˆ ì‚´ì•„ìˆìŒ

interval(1000)
  â†’ ë¬´í•œíˆ ê°’ ë°©ì¶œ (0, 1, 2, 3, ...)
  â†’ ìë™ìœ¼ë¡œ complete ì•ˆ ë¨ âŒ
  â†’ ìˆ˜ë™ìœ¼ë¡œ êµ¬ë… ì·¨ì†Œ í•„ìš”

fromEvent(element, 'click')
  â†’ ì´ë²¤íŠ¸ê°€ ê³„ì† ë°œìƒ
  â†’ ìë™ìœ¼ë¡œ complete ì•ˆ ë¨ âŒ
  â†’ ìˆ˜ë™ìœ¼ë¡œ êµ¬ë… ì·¨ì†Œ í•„ìš”
`);


console.log('\n\n===== 4. switchMap ë‚´ë¶€ Observableì˜ complete =====\n');

console.log(`
switchMap ë™ì‘ ì›ë¦¬:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

click$.pipe(
  switchMap(() => timer(1000).pipe(
    tap({ complete: () => console.log('A') })
  ))
)

ë™ì‘:
1. í´ë¦­ 1
   â†’ timer(1000) ì‹œì‘
   â†’ 1ì´ˆ í›„ timer ê°’ ë°©ì¶œ
   â†’ timer ìë™ complete âœ…
   â†’ "A" ì¶œë ¥

2. í´ë¦­ 2 (timer ì§„í–‰ ì¤‘)
   â†’ ì´ì „ timer unsubscribe (complete âŒ)
   â†’ ìƒˆ timer(1000) ì‹œì‘
   â†’ 1ì´ˆ í›„ timer ê°’ ë°©ì¶œ
   â†’ timer ìë™ complete âœ…
   â†’ "A" ì¶œë ¥

3. click$ ì™„ë£Œí•˜ì§€ ì•Šìœ¼ë©´
   â†’ ì™¸ë¶€ ìŠ¤íŠ¸ë¦¼ complete ì•ˆ ë¨ âŒ
   â†’ êµ¬ë… ê³„ì† ì‚´ì•„ìˆìŒ


í•µì‹¬ í¬ì¸íŠ¸:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ë‚´ë¶€ Observable (timer)ì˜ complete:
  - timer ìì²´ê°€ ìë™ìœ¼ë¡œ ë°œìƒ âœ…
  - ë§¤ë²ˆ timerê°€ ì™„ë£Œë  ë•Œë§ˆë‹¤ í˜¸ì¶œ
  - click$.complete()ì™€ ë¬´ê´€!

ì™¸ë¶€ Observable (click$)ì˜ complete:
  - click$.complete()ë¥¼ ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼ í•¨ âŒ
  - í˜¸ì¶œí•˜ì§€ ì•Šìœ¼ë©´ ì ˆëŒ€ ë°œìƒ ì•ˆ ë¨
  - ì „ì²´ ìŠ¤íŠ¸ë¦¼ì„ ì¢…ë£Œì‹œí‚´
`);


console.log('\n\n===== 5. ì‹¤ì „ ì˜ˆì œ ë¶„ì„ =====\n');

console.log(`
ì›ë³¸ ì½”ë“œ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

const click$ = new Subject<void>();

const counter$ = click$.pipe(
  switchMap((count) => {
    return timer(1000).pipe(
      tap({
        complete: () => console.log('[ë‚´ë¶€] timer ì™„ë£Œ')  // â† 62-63ì¤„
      })
    );
  })
);

counter$.subscribe({
  next: (count) => console.log('âœ¨ ìµœì¢… ì¹´ìš´íŠ¸'),
  complete: () => console.log('ğŸ”¥ êµ¬ë… ì™„ë£Œ')  // â† 88-91ì¤„ (ì£¼ì„)
});


ì‹¤í–‰ íë¦„:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‘† í´ë¦­ 1
  â†’ timer(1000) ì‹œì‘
  â†’ 1ì´ˆ í›„:
    - timer ê°’ ë°©ì¶œ (next)
    - âœ¨ ìµœì¢… ì¹´ìš´íŠ¸ ì¶œë ¥
    - timer ìë™ complete
    - [ë‚´ë¶€] timer ì™„ë£Œ ì¶œë ¥ âœ…

ğŸ‘† í´ë¦­ 2
  â†’ ì´ì „ timer unsubscribe
  â†’ ìƒˆ timer(1000) ì‹œì‘
  â†’ 1ì´ˆ í›„:
    - timer ê°’ ë°©ì¶œ (next)
    - âœ¨ ìµœì¢… ì¹´ìš´íŠ¸ ì¶œë ¥
    - timer ìë™ complete
    - [ë‚´ë¶€] timer ì™„ë£Œ ì¶œë ¥ âœ…

... í”„ë¡œê·¸ë¨ ê³„ì† ì‹¤í–‰ ...
  â†’ click$.complete() í˜¸ì¶œ ì•ˆ í•¨
  â†’ ğŸ”¥ êµ¬ë… ì™„ë£Œ ì ˆëŒ€ ì¶œë ¥ ì•ˆ ë¨ âŒ


ê²°ë¡ :
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

62-63ì¤„ "[ë‚´ë¶€] timer ì™„ë£Œ":
  âœ… timerê°€ ìë™ìœ¼ë¡œ complete ë°œìƒ
  âœ… click$.complete()ì™€ ë¬´ê´€
  âœ… ë§¤ í´ë¦­ë§ˆë‹¤ timer ì™„ë£Œ ì‹œ í˜¸ì¶œ

88-91ì¤„ "ğŸ”¥ êµ¬ë… ì™„ë£Œ" (ì£¼ì„):
  âŒ click$.complete() í•„ìš”
  âŒ í˜„ì¬ í˜¸ì¶œë˜ì§€ ì•ŠìŒ
  âŒ ì£¼ì„ í•´ì œí•´ë„ click$.complete() ì—†ìœ¼ë©´ ì•ˆ ë¨


ìˆ˜ì • ë²„ì „:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

setTimeout(() => {
  console.log('ğŸ›‘ Subject ì™„ë£Œ');
  click$.complete();  // â† ì´ì œ 88-91ì¤„ í˜¸ì¶œë¨!
}, 5000);

â†’ 5ì´ˆ í›„:
  - click$ complete
  - [ì™¸ë¶€] ì „ì²´ ìŠ¤íŠ¸ë¦¼ ì™„ë£Œ
  - ğŸ”¥ êµ¬ë… ì™„ë£Œ âœ…
`);


console.log('\n\n===== 6. í•µì‹¬ ìš”ì•½ =====\n');

console.log(`
ë‘ ê°€ì§€ ë‹¤ë¥¸ complete:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1ï¸âƒ£ ë‚´ë¶€ Observableì˜ complete (62-63ì¤„)
   - timer(1000) ìì²´ê°€ ë°œìƒ
   - ìë™ ì™„ë£Œ (Cold Observable)
   - click$.complete()ì™€ ë¬´ê´€
   - ë§¤ë²ˆ timer ì™„ë£Œ ì‹œ í˜¸ì¶œë¨ âœ…

2ï¸âƒ£ ì™¸ë¶€ Observableì˜ complete (88-91ì¤„)
   - click$.complete() í•„ìš”
   - ìˆ˜ë™ ì™„ë£Œ (Hot Observable)
   - ëª…ì‹œì ìœ¼ë¡œ í˜¸ì¶œí•´ì•¼ í•¨
   - í˜„ì¬ ì£¼ì„ ì²˜ë¦¬ë˜ì–´ í˜¸ì¶œ ì•ˆ ë¨ âŒ


Observable ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… timer(n) â†’ ìë™ complete
âœ… of(...) â†’ ìë™ complete
âœ… from([...]) â†’ ìë™ complete
âŒ Subject â†’ ìˆ˜ë™ complete í•„ìš”
âŒ interval(n) â†’ ìˆ˜ë™ complete í•„ìš”
âŒ fromEvent(...) â†’ ìˆ˜ë™ complete í•„ìš”


ì‹¤ì „ íŒ:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ë‚´ë¶€ Observableì˜ complete ê°ì§€:
  tap({ complete: () => ... })

ì™¸ë¶€ Observableì˜ complete ê°ì§€:
  subscribe({ complete: () => ... })

ë‘˜ì€ ì™„ì „íˆ ë‹¤ë¥¸ ì‹œì ì— í˜¸ì¶œë¨!
`);

export {};
